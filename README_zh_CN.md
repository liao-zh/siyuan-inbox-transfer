
# 思源笔记-收集箱中转站插件

作者：Liao-ZH

Gitee仓库：[siyuan-inbox-transfer](https://gitee.com/liao_zh/siyuan-inbox-transfer)

[English Readme](./README.md)

[更新历史](./CHANGELOG.md)

## 简介

思源笔记收集箱能便捷地通过微信助手收集消息和链接，但要将收集箱中的条目整理到笔记中还有些不便。主要的不便之处包括，刷新时要在二级菜单中点击，整理时不能在dock栏中直接编辑条目内容，如果复制粘贴也需要选中等操作，如果移动和删除也要进入二级菜单。

为缓解这一问题，一种思路是将一个文档树中的路径作为中转站，将收集箱所有条目移动到该路径转换成文档，这样就可以利用编辑器的强大功能进行编辑，或以块为单位方便地复制粘贴。一般将中转文档中的内容进行筛选并整理到其它文档中，再将中转文档删除。本插件为简化这一工作流程而设计。


## 如何安装

文件准备：下载本repo，解压package.zip，重命名为`siyuan-inbox-transfer`，移动到`工作空间/data/plugins/`目录下。

启用插件：在思源笔记中，点击`设置->集市->插件`，找到`收集箱中转站（siyuan-inbox-transfer）`，点击`启用`。

## 如何使用

工作流前的设置：新建或选择一个文档作为中转站，在设置中填入中转站ID。

如何使用本插件dock栏：日常的工作流
1. 刷新：会在后台完成如下操作，获取收集箱所有条目，转成文档移动到中转站中，可选从收集箱删除已移动的条目；
2. 中转文件：所有中转站中的文件会显示在dock栏中，便于集中操作，注意收集箱的条目是不显示的，因为已经被中转；
3. 文件单选/多选/全选：批量打开文件，整理内容后，批量删除文件；
4. 在文档树中定位中转站：利用文档树更丰富的功能对文件进行操作。

其它设置：
- 转换成文档时是否将收集时间作为前缀：可用前缀标记收集时间；
- 收集箱条目被移动后是否全部删除， 中转文档删除时是否确认：删除条目和不进行删除确认，可以获得更快的工作流。
- 替换内置收集箱：可选择替换内置收集箱的dock栏和快捷键（默认Alt+6），重启后生效。

其它功能说明：
- dock栏快捷键：默认Shift+Alt+6，替换内置收集箱后为Alt+6，可在设置中修改。
- 打开文档：Alt+单击时在右侧新页签打开，Ctrl+单击时在后台打开，二者可同时使用。

## 代码说明

代码结构：（未列出的部分与插件模板相同）
```bash
src/
├── index.ts：插件入口
├── worker/：用于执行主要功能
│   ├── settingService.ts：设置服务，负责处理设置的读取、写入和默认值
│   ├── inboxManager.ts：收集箱管理器，负责获取收集箱条目，并新建为中转文档
│   ├── fileManager.ts：文件管理器，负责获取中转站信息，并处理中转文档的更新、打开、删除等操作
|   ├── dockComponent.svelte：dock栏组件具体内容，用svelte处理UI和函数操作
├── utils/：提供工具
│   ├── api.ts：思源API的封装（来自模板）
│   ├── logger.ts：日志工具
│   ├── replaceBuiltIn.ts：替换内置收集箱（参考书签+插件代码）
```

## 问题

暂时不支持移动端。

有时在dock栏不显示图标，需要重启几次。

## 参考

本插件的架构基于插件示例[plugin-sample-vite-svelte](https://github.com/siyuan-note/plugin-sample-vite-svelte)。参考了思源笔记源码的收集箱模块（`siyuan/app/src/layout/dock/Inbox.ts`），和[书签+插件](https://github.com/frostime/sy-bookmark-plus)。
